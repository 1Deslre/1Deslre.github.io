<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>黑马点评</title>
    <link href="/2024/02/03/%E9%BB%91%E9%A9%AC%E7%82%B9%E8%AF%84/"/>
    <url>/2024/02/03/%E9%BB%91%E9%A9%AC%E7%82%B9%E8%AF%84/</url>
    
    <content type="html"><![CDATA[<img src="/2024/02/03/%E9%BB%91%E9%A9%AC%E7%82%B9%E8%AF%84/2024%E5%B9%B42%E6%9C%883%E6%97%A516%E7%82%B953%E5%88%86.jpg" class=""> <p>在学习黑马的 Reids 时，P37 留了一个课后作业，不过应该写在 service 层里面而不是写在 controller 层里面。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/shop-type&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShopTypeController</span> &#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> IShopTypeService typeService;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> StringRedisTemplate stringRedisTemplate;<br><br>    <span class="hljs-meta">@GetMapping(&quot;list&quot;)</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">queryTypeList</span><span class="hljs-params">()</span> &#123;<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> CACHE_SHOP_TYPE_KEY;<br>        <span class="hljs-comment">// 1.查询redis缓存</span><br>        List&lt;String&gt; typeJson = stringRedisTemplate.opsForList().range(key, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>);<br>        <span class="hljs-comment">// 2.判断是否命中</span><br>        <span class="hljs-keyword">if</span> (CollectionUtil.isNotEmpty(typeJson)) &#123;<br>            <span class="hljs-comment">// 2.0 如果为空对象(防止缓存穿透时存入的空对象)</span><br>            <span class="hljs-keyword">if</span> (StrUtil.isBlank(typeJson.get(<span class="hljs-number">0</span>))) &#123;<br>                <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;商品分类信息为空！&quot;</span>);<br>            &#125;<br>            <span class="hljs-comment">// 2.1 命中则转换List&lt;String&gt; -&gt; List&lt;ShopType&gt; 并返回、</span><br>            List&lt;ShopType&gt; typeList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>            <span class="hljs-keyword">for</span> (String jsonString : typeJson) &#123;<br>                <span class="hljs-type">ShopType</span> <span class="hljs-variable">shopType</span> <span class="hljs-operator">=</span> JSONUtil.toBean(jsonString, ShopType.class);<br>                typeList.add(shopType);<br>            &#125;<br>            <span class="hljs-keyword">return</span> Result.ok(typeList);<br>        &#125;<br>        <span class="hljs-comment">// 3. 未命中，查询数据库</span><br>        List&lt;ShopType&gt; typeList = typeService.query().orderByAsc(<span class="hljs-string">&quot;sort&quot;</span>).list();<br>        <span class="hljs-comment">// 3.1 数据库中不存在</span><br>        <span class="hljs-keyword">if</span> (CollectionUtil.isEmpty(typeList)) &#123;<br>            <span class="hljs-comment">// 添加空对象到redis，解决缓存穿透</span><br>            stringRedisTemplate.opsForList().rightPushAll(key, CollectionUtil.newArrayList(<span class="hljs-string">&quot;&quot;</span>));<br>            stringRedisTemplate.expire(key, CACHE_NULL_TTL, TimeUnit.MINUTES);<br>            <span class="hljs-comment">// 返回错误</span><br>            <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;商品分类信息为空！&quot;</span>);<br>        &#125;<br>        <span class="hljs-comment">// 3.2 数据库中存在,转换List&lt;ShopType&gt; -&gt; List&lt;String&gt; 类型</span><br>        List&lt;String&gt; shopTypeList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (ShopType shopType : typeList) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">jsonStr</span> <span class="hljs-operator">=</span> JSONUtil.toJsonStr(shopType);<br>            shopTypeList.add(jsonStr);<br>        &#125;<br>        <span class="hljs-comment">// 4.写入redis缓存, 有顺序只能RPUSH</span><br>        stringRedisTemplate.opsForList().rightPushAll(key, shopTypeList);<br>        <span class="hljs-comment">// 5. 返回</span><br>        <span class="hljs-keyword">return</span> Result.ok(typeList);<br><br><span class="hljs-comment">//        List&lt;ShopType&gt; typeList = typeService</span><br><span class="hljs-comment">//                .query().orderByAsc(&quot;sort&quot;).list();</span><br><span class="hljs-comment">//        return Result.ok(typeList);</span><br>    &#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>黑马点评</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>测试</title>
    <link href="/2024/01/29/Boot%E6%95%B4%E5%90%88Redis%E6%90%AD%E5%BB%BA/"/>
    <url>/2024/01/29/Boot%E6%95%B4%E5%90%88Redis%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<p>​<img src="/2024/01/29/Boot%E6%95%B4%E5%90%88Redis%E6%90%AD%E5%BB%BA/downloaded_image.jpg" class=""></p>]]></content>
    
    
    <categories>
      
      <category>测试</category>
      
    </categories>
    
    
  </entry>
  
  
  
  
</search>
